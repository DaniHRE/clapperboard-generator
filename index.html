<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Claquete Digital</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #000;
      --fg: #fff;
      --accent: #e11212;
      --border: #ffffff;
      --line: 2px;
      --maxw: unset; /* Remove completamente qualquer limita√ß√£o */
      --gap: 0;
    }

    @font-face{
      font-family: "DS-Digi";
      src: url("./DS-DIGI.TTF") format("truetype");
      font-weight: 400 700;
      font-style: normal;
      font-display: swap;
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: 'Montserrat', sans-serif;
      line-height: 1.25;
      /* Garantir que o body n√£o limite a largura */
      width: 100vw;
      max-width: none !important;
      overflow-x: auto;
    }

    .frame{
      width: 96vw; /* 96% da largura da tela - m√°xima expans√£o lateral */
      margin: 2vw auto; /* Margens m√≠nimas */
      display: grid;
      gap: var(--gap);
      box-sizing: border-box;
      /* Garantir expans√£o sem limita√ß√µes */
      max-width: none;
      min-width: 300px; /* M√≠nimo para n√£o quebrar em telas muito pequenas */
    }

    .grid{
      display: grid;
      gap: var(--gap);
      grid-template-columns: repeat(12, 1fr);
    }

    .box{
      border: var(--line) solid var(--border);
      padding: clamp(12px, 1.5vw, 16px);
      min-height: 84px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .label{
      font-size: clamp(9px, 1vw, 11px);
      letter-spacing: .08em;
      text-transform: uppercase;
      opacity: 1;
      font-weight: bold;
      color: #ffffff;
      padding: 0 8px;
      margin-bottom: 2px;
    }
    .value{ margin-top: .1rem; font-weight: 700; font-size: clamp(15px, 1.8vw, 20px); padding: 0 12px; }
    .value-xl{ font-size: clamp(18px, 2.4vw, 24px); }
    .value-xxl{ font-size: clamp(36px, 5vw, 64px); }

    .digital{ font-family: "DS-Digi", monospace; color: var(--accent); letter-spacing: .04em; font-size: clamp(54px, 8vw, 110px) !important; }

    .top-left{ grid-column: 1 / span 6; }
    .top-right{ grid-column: 7 / span 6; padding: 0; display: flex; flex-direction: column; }

    .flexdata{
      display: flex;
      flex-direction: column;
      flex: 1;
      height: 100%;
    }
    .cell{
      flex: 1;
      border-top: var(--line) solid var(--border);
      padding: clamp(12px, 1.5vw, 16px);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .cell:first-child{ border-top: none; }

    /* Ajuste: FPS e Camera lado a lado na mesma linha */
    .row-split{
      display: grid;
      grid-template-columns: 1fr 1fr;
      flex: 1;
    }
    .row-split .cell{
      border-top: var(--line) solid var(--border);
      border-left: var(--line) solid var(--border);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .row-split .cell:first-child{ border-left: none; }

    .center-banner{ grid-column: 1 / span 12; align-items: center; justify-content: center; text-align: center; padding: clamp(4px, 0.5vw, 8px); }

    .low-slate{ grid-column: 1 / span 3; }
    .low-roll{  grid-column: 4 / span 3; }
    .low-scene{ grid-column: 7 / span 3; }
    .low-take{  grid-column: 10 / span 3; }

    .notes{ grid-column: 1 / span 12; min-height: 96px; }

    /* Mobile - Vertical APENAS no modo retrato */
    @media (max-width: 760px) and (orientation: portrait){
      .frame {
        width: 98vw; /* 98% da largura no mobile - m√°xima expans√£o */
        margin: 1vw auto;
      }
      .top-left, .top-right, .center-banner, .low-slate, .low-roll, .low-scene, .low-take, .notes{
        grid-column: 1 / -1; /* Uma coluna s√≥ no mobile em retrato */
      }
      .value-xxl{ font-size: clamp(32px, 10vw, 56px); }
    }

    /* Mobile - Paisagem (ex.: Galaxy S8+ deitado) mant√©m layout horizontal */
    @media (max-width: 760px) and (orientation: landscape){
      .frame { width: 100vw; margin: 1vw auto; }
      /* N√£o sobrescreve grid-column -> mant√©m 12 colunas */
      .label{ font-size: clamp(8px, 1.6vw, 10px); }
      .value{ font-size: clamp(12px, 2.2vw, 16px); }
      .value-xl{ font-size: clamp(14px, 2.6vw, 18px); }
      .value-xxl{ font-size: clamp(22px, 6vw, 40px); }
    }

    /* Tablet - Expans√£o lateral m√°xima */
    @media (min-width: 761px) and (max-width: 1024px){
      .frame {
        width: 97vw; /* 97% da largura - expans√£o lateral m√°xima */
        margin: 1.5vw auto;
      }
    }

    /* Desktop - Expans√£o lateral total */
    @media (min-width: 1025px){
      .frame {
        width: 95vw; /* 95% da largura - expans√£o lateral total */
        margin: 2.5vw auto;
      }
    }

    /* Telas ultra-wide - Expans√£o m√°xima */
    @media (min-width: 1400px){
      .frame {
        width: 96vw; /* 96% da largura para telas muito largas */
        margin: 2vw auto;
      }
    }

    /* Telas gigantes - Expans√£o absoluta */
    @media (min-width: 1920px){
      .frame {
        width: 97vw; /* 97% da largura para telas gigantes */
        margin: 1.5vw auto;
      }
    }

    /* Telas ultra-wide */
    @media (min-width: 1400px){
      .frame {
        width: 85vw; /* 85% para telas muito largas */
        margin: 4vw auto;
      }
    }

    .stack > .pair + .pair{ margin-top: clamp(10px, 1.2vw, 14px); }

    /* Estilos para campos edit√°veis */
    [contenteditable="true"] {
      outline: none;
      cursor: text;
      transition: background-color 0.2s ease;
    }
    [contenteditable="true"]:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    [contenteditable="true"]:focus {
      background-color: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.2);
    }
    [contenteditable="true"]:empty:before {
      content: attr(data-placeholder);
      color: rgba(255, 255, 255, 0.5);
    }

    /* Controles */
    .controls {
      margin: 20px auto;
      text-align: center;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .btn {
      background: var(--bg);
      color: var(--fg);
      border: var(--line) solid var(--border);
      padding: 8px 16px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s ease;
    }
    .btn:hover {
      background: var(--fg);
      color: var(--bg);
    }

    /* Modo Tela Cheia */
    .fullscreen-mode {
      position: fixed !important;
      top: 0;
      left: 0;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 9999;
      background: var(--bg);
      margin: 0 !important;
      max-width: none !important;
      padding: 0 !important;
    }

    .fullscreen-mode .frame {
      width: 100vw !important; /* Ocupa toda a largura em fullscreen */
      max-width: none !important;
      margin: 0 !important;
    }

    .fullscreen-mode .grid {
      height: 100vh;
      width: 100vw;
      padding: clamp(4px, 1vw, 8px);
      box-sizing: border-box;
      margin: 0;
    }

    .fullscreen-mode .box {
      border-width: clamp(1px, 0.3vw, 2px);
      min-height: auto;
    }

    .fullscreen-mode .controls {
      position: fixed;
      top: 5px;
      right: 5px;
      background: rgba(0, 0, 0, 0.9);
      padding: 5px;
      border-radius: 6px;
      margin: 0;
      z-index: 10000;
      opacity: 0.2;
      transition: opacity 0.3s ease;
      transform: scale(0.7);
    }

    .fullscreen-mode .controls:hover,
    .fullscreen-mode .controls:active {
      opacity: 1;
      transform: scale(1);
    }

    .fullscreen-mode .controls .btn {
      padding: 4px 6px;
      font-size: 8px;
      margin: 1px;
      border-width: 1px;
    }

    .fullscreen-exit-btn {
      position: fixed !important;
      top: 10px;
      left: 10px;
      z-index: 10001;
      background: rgba(255, 0, 0, 0.9) !important;
      color: white !important;
      border: 1px solid white !important;
      padding: 8px 10px !important;
      font-size: 12px !important;
      border-radius: 6px;
      opacity: 0.6;
      transition: all 0.3s ease;
      transform: scale(0.8);
    }

    .fullscreen-exit-btn:hover,
    .fullscreen-exit-btn:active {
      opacity: 1;
      background: rgba(255, 0, 0, 1) !important;
      transform: scale(1);
    }

    /* Otimiza√ß√µes espec√≠ficas para mobile em tela cheia */
    @media (max-width: 768px) {
      .fullscreen-mode {
        /* Remover qualquer padding/margin */
        padding: 0 !important;
        margin: 0 !important;
      }
      
      .fullscreen-mode .grid {
        padding: 2px;
        gap: 0;
      }
      
      .fullscreen-mode .box {
        padding: clamp(4px, 1.5vw, 8px);
        border-width: 1px;
      }
      
      .fullscreen-mode .value-xxl {
        font-size: clamp(20px, 6vw, 40px) !important;
      }
      
      .fullscreen-mode .digital {
        font-size: clamp(28px, 8vw, 50px) !important;
        letter-spacing: 0.02em !important;
      }
      
      .fullscreen-mode .label {
        font-size: clamp(6px, 1.5vw, 9px);
        margin-bottom: 1px;
      }
      
      .fullscreen-mode .value {
        font-size: clamp(10px, 2.5vw, 14px);
        margin-top: 0.05rem;
      }
      
      .fullscreen-mode .value-xl {
        font-size: clamp(12px, 3vw, 18px);
      }

      /* Bot√£o de sa√≠da menor no mobile */
      .fullscreen-exit-btn {
        top: 5px;
        left: 5px;
        padding: 6px 8px !important;
        font-size: 10px !important;
        transform: scale(0.7);
      }
      
      .fullscreen-mode .controls {
        top: 3px;
        right: 3px;
        padding: 3px;
        transform: scale(0.6);
      }
      
      .fullscreen-mode .controls:hover,
      .fullscreen-mode .controls:active {
        transform: scale(0.8);
      }
    }

    /* Landscape espec√≠fico para celular */
    @media (max-width: 768px) and (orientation: landscape) {
      .fullscreen-mode .digital {
        font-size: clamp(32px, 10vw, 60px) !important;
      }
      
      .fullscreen-mode .value-xxl {
        font-size: clamp(24px, 7vw, 48px) !important;
      }
    }

    /* Portrait espec√≠fico para celular */
    @media (max-width: 768px) and (orientation: portrait) {
      .fullscreen-mode .grid {
        padding: 4px;
      }
      
      .fullscreen-mode .digital {
        font-size: clamp(24px, 6vw, 36px) !important;
      }
      
      .fullscreen-mode .value-xxl {
        font-size: clamp(18px, 5vw, 28px) !important;
      }
    }

    /* CSS espec√≠fico para iOS Safari fullscreen */
    .ios-fullscreen {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 99999 !important;
      background: black !important;
      
      /* Esconder barras do Safari */
      -webkit-appearance: none;
      appearance: none;
      
      /* Garantir que ocupe toda a tela no iOS */
      min-height: 100vh !important;
      min-height: -webkit-fill-available !important;
      
      /* Suporte para safe areas no iOS */
      padding-top: env(safe-area-inset-top, 0);
      padding-bottom: env(safe-area-inset-bottom, 0);
      padding-left: env(safe-area-inset-left, 0);
      padding-right: env(safe-area-inset-right, 0);
    }

    .ios-fullscreen img {
      width: 100vw !important;
      height: 100vh !important;
  object-fit: contain !important;
      object-position: center !important;
      padding: 0 !important;
      margin: 0 !important;
      /* Ajuste para safe areas */
      width: calc(100vw - env(safe-area-inset-left, 0) - env(safe-area-inset-right, 0)) !important;
      height: calc(100vh - env(safe-area-inset-top, 0) - env(safe-area-inset-bottom, 0)) !important;
    }

    /* Estilos espec√≠ficos para iPhone 13 e similares */
    @media screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) {
      /* iPhone 13/13 Pro espec√≠fico */
      .ios-fullscreen {
        /* Compensar notch e bot√£o home */
        padding-top: 47px !important;
        padding-bottom: 34px !important;
      }
      
      .ios-fullscreen img {
        height: calc(100vh - 81px) !important; /* 47px top + 34px bottom */
        width: 100vw !important;
      }
    }

    @media screen and (device-width: 414px) and (device-height: 896px) {
      /* iPhone XR, 11 */
      .ios-fullscreen {
        padding-top: 44px !important;
        padding-bottom: 34px !important;
      }
      
      .ios-fullscreen img {
        height: calc(100vh - 78px) !important;
        width: 100vw !important;
      }
    }

    @media screen and (device-width: 375px) and (device-height: 812px) {
      /* iPhone X, XS, 11 Pro */
      .ios-fullscreen {
        padding-top: 44px !important;
        padding-bottom: 34px !important;
      }
      
      .ios-fullscreen img {
        height: calc(100vh - 78px) !important;
        width: 100vw !important;
      }
    }

    /* Ocultar scrollbars completamente */
    .fullscreen-mode::-webkit-scrollbar {
      display: none;
    }
    
    .fullscreen-mode {
      -ms-overflow-style: none;
      scrollbar-width: none;
      overflow: hidden;
    }

    /* Pr√©via PNG em Tela Cheia */
    .png-preview-fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      /* For√ßar ocupa√ß√£o total no mobile */
      min-height: -webkit-fill-available;
      min-height: 100vh;
      overflow: hidden;
    }

    .png-preview-fullscreen img {
      width: 100vw;
      height: 100vh;
  object-fit: contain; /* garantir claquete inteira no preview */
      object-position: center;
      border: none;
      /* Garantir centraliza√ß√£o no mobile */
      display: block;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .png-preview-close {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 0, 0, 0.9);
      color: white;
      border: 2px solid white;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      z-index: 10001;
      font-weight: bold;
    }

    .png-preview-instructions {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 20px;
      border-radius: 20px;
      font-size: 14px;
      text-align: center;
      z-index: 10001;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    @media (max-width: 768px) {
      .png-preview-fullscreen {
        /* Ajustar altura para mobile considerando barras do navegador */
        height: 100vh;
        min-height: 100vh;
        padding: 0;
        box-sizing: border-box;
      }
      
      .png-preview-fullscreen img {
        width: 100vw;
        height: 100vh;
        padding: 0;
        margin: 0;
        /* Garantir que a imagem inteira seja vis√≠vel mantendo aspect ratio */
        object-fit: contain;
        object-position: center;
      }
      
      .png-preview-instructions {
        bottom: 20px;
        font-size: 12px;
        padding: 8px 16px;
      }
    }

    /* Evitar zoom no mobile */
    .fullscreen-mode input,
    .fullscreen-mode [contenteditable] {
      font-size: 16px !important; /* Evita zoom autom√°tico no iOS */
    }
  </style>
</head>
<body>
  <main class="frame">
    <section class="grid">

      <div class="box top-left">
        <div class="stack">
          <div class="pair">
            <div class="label">Title</div>
            <div class="value value-xl" contenteditable="true" id="title">Metodologias √Ågeis</div>
          </div>
          <div class="pair">
            <div class="label">Dir</div>
            <div class="value value-xl" contenteditable="true" id="director">Lucas Caetano</div>
          </div>
          <div class="pair">
            <div class="label">DP</div>
            <div class="value value-xl" contenteditable="true" id="dp">Lucas Caetano</div>
          </div>
        </div>
      </div>

      <div class="box top-right">
        <div class="flexdata">
          <div class="cell">
            <div class="label">Date</div>
            <div class="value value-xl" contenteditable="true" id="date" style="font-size: 32px;">19 set 2025 - 14:30</div>
          </div>
          <div class="row-split">
            <div class="cell">
              <div class="label">FPS</div>
              <div class="value value-xl" contenteditable="true" id="fps" style="font-size: 35px;">30</div>
            </div>
            <div class="cell">
              <div class="label">Camera</div>
              <div class="value" contenteditable="true" id="camera" style="font-size: 53px;">&nbsp;</div>
            </div>
          </div>
        </div>
      </div>

      <div class="box center-banner">
        <div class="value-xxl digital" contenteditable="true" id="teaser">TEASER</div>
      </div>

      <div class="box low-slate">
        <div class="label">Slate</div>
        <div class="value value-xxl" contenteditable="true" id="slate">A1</div>
      </div>
      <div class="box low-roll">
        <div class="label">Roll</div>
        <div class="value value-xxl" contenteditable="true" id="roll">1</div>
      </div>
      <div class="box low-scene">
        <div class="label">Scene</div>
        <div class="value value-xxl" contenteditable="true" id="scene">1</div>
      </div>
      <div class="box low-take">
        <div class="label">Take</div>
        <div class="value value-xxl" contenteditable="true" id="take">1</div>
      </div>

      <div class="box notes">
        <div class="label">Notes</div>
        <div class="value" contenteditable="true" id="notes" style="min-height: 60px; margin-top: 8px;">&nbsp;</div>
      </div>

    </section>
    
    <div class="controls">
      <button class="btn" onclick="saveData()">Salvar</button>
      <button class="btn" onclick="loadData()">Carregar</button>
      <button class="btn" onclick="resetData()">Limpar</button>
      <button class="btn" onclick="incrementTake()">Next Take</button>
      <button class="btn" onclick="exportImage()">üíæ Exportar PNG</button>
      <button class="btn" onclick="showPreview()" id="preview-btn">üé¨ Preview</button>
    </div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // Campos edit√°veis
    const fields = {
      title: document.getElementById('title'),
      director: document.getElementById('director'),
      dp: document.getElementById('dp'),
      date: document.getElementById('date'),
      fps: document.getElementById('fps'),
      camera: document.getElementById('camera'),
      teaser: document.getElementById('teaser'),
      slate: document.getElementById('slate'),
      roll: document.getElementById('roll'),
      scene: document.getElementById('scene'),
      take: document.getElementById('take'),
      notes: document.getElementById('notes')
    };

    // Auto-save quando campos s√£o alterados
    Object.values(fields).forEach(field => {
      field.addEventListener('input', autoSave);
      field.addEventListener('blur', autoSave);
    });

    // S√≥ n√∫meros nos campos num√©ricos
    ['fps', 'roll', 'scene', 'take'].forEach(fieldName => {
      fields[fieldName].addEventListener('input', function(e) {
        this.textContent = this.textContent.replace(/[^0-9]/g, '');
      });
    });

    // Fun√ß√µes principais
    function saveData() {
      const data = {};
      Object.keys(fields).forEach(key => {
        data[key] = fields[key].textContent || fields[key].innerText;
      });
      localStorage.setItem('claqueteData', JSON.stringify(data));
      showNotification('Dados salvos!');
    }

    function loadData() {
      const saved = localStorage.getItem('claqueteData');
      if (saved) {
        const data = JSON.parse(saved);
        Object.keys(data).forEach(key => {
          if (fields[key]) {
            fields[key].textContent = data[key];
          }
        });
        showNotification('Dados carregados!');
      } else {
        showNotification('Nenhum dado salvo encontrado!');
      }
    }

    function resetData() {
      if (confirm('Limpar todos os campos?')) {
        fields.title.textContent = 'Metodologias √Ågeis';
        fields.director.textContent = 'Lucas Caetano';
        fields.dp.textContent = 'Lucas Caetano';
        fields.date.textContent = getCurrentDate();
        fields.fps.textContent = '30';
        fields.camera.textContent = '';
        fields.teaser.textContent = 'TEASER';
        fields.slate.textContent = 'A1';
        fields.roll.textContent = '1';
        fields.scene.textContent = '1';
        fields.take.textContent = '1';
        fields.notes.textContent = '';
        localStorage.removeItem('claqueteData');
        showNotification('Dados limpos!');
      }
    }

    function incrementTake() {
      const currentTake = parseInt(fields.take.textContent) || 0;
      fields.take.textContent = currentTake + 1;
      autoSave();
      showNotification(`Take: ${currentTake + 1}`);
    }

    function autoSave() {
      const data = {};
      Object.keys(fields).forEach(key => {
        data[key] = fields[key].textContent || fields[key].innerText;
      });
      localStorage.setItem('claqueteData', JSON.stringify(data));
    }

    function getCurrentDate() {
      const now = new Date();
      const months = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      return `${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()} - ${hours}:${minutes}`;
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 1000;
        background: var(--bg); color: var(--fg); border: 2px solid var(--border);
        padding: 12px 16px; font-size: 12px; font-weight: 600;
        text-transform: uppercase; letter-spacing: 0.05em;
        opacity: 0; transform: translateX(100%); transition: all 0.3s ease;
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
      }, 10);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => document.body.removeChild(notification), 300);
      }, 2500);
    }

    // Fun√ß√£o para exportar como imagem (s√≥ salva) - SEMPRE EM LANDSCAPE
    function exportImage() {
      showNotification('Gerando e salvando imagem...');
      
      // Esconder os controles temporariamente
      const controls = document.querySelector('.controls');
      controls.style.display = 'none';
      
      // Capturar apenas a claquete
      const claqueteElement = document.querySelector('.frame');
      
      // FOR√áAR DIMENS√ïES LANDSCAPE para captura
      const originalWidth = claqueteElement.offsetWidth;
      const originalHeight = claqueteElement.offsetHeight;
      
      // Garantir propor√ß√£o landscape m√≠nima (16:9 ou similar)
      const landscapeWidth = Math.max(originalWidth, originalHeight * 1.6);
      const landscapeHeight = Math.min(originalHeight, landscapeWidth / 1.6);
      
      html2canvas(claqueteElement, {
        backgroundColor: '#000000',
        scale: 2, // Maior qualidade
        useCORS: true,
        allowTaint: false,
        width: landscapeWidth,
        height: landscapeHeight,
        onclone: (clonedDoc) => {
          // Garantir que a fonte seja carregada no clone
          const clonedElement = clonedDoc.querySelector('.digital');
          if (clonedElement) {
            clonedElement.style.fontFamily = '"DS-Digi", monospace';
          }
          // For√ßar largura landscape no elemento clonado
          const clonedFrame = clonedDoc.querySelector('.frame');
          if (clonedFrame) {
            clonedFrame.style.width = landscapeWidth + 'px';
            clonedFrame.style.height = landscapeHeight + 'px';
            clonedFrame.style.minWidth = landscapeWidth + 'px';
            clonedFrame.style.maxHeight = landscapeHeight + 'px';
          }
        }
      }).then(canvas => {
        // Restaurar controles
        controls.style.display = 'flex';
        
        // Criar nome do arquivo
        const slate = fields.slate.textContent || 'A1';
        const scene = fields.scene.textContent || '1';
        const take = fields.take.textContent || '1';
        const filename = `claquete_${slate}_${scene}_${take}.png`;
        
        // Download autom√°tico da imagem
        const link = document.createElement('a');
        link.download = filename;
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
        
        showNotification(`‚úÖ Imagem salva em landscape: ${filename}`);
        
      }).catch(error => {
        // Restaurar controles em caso de erro
        controls.style.display = 'flex';
        console.error('Erro ao exportar:', error);
        showNotification('‚ùå Erro ao exportar imagem');
      });
    }

    // Fun√ß√£o para verificar se est√° em landscape no mobile
    function isMobileLandscape() {
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      if (!isMobile) {
        return true; // Desktop sempre pode usar
      }
      
      // Para iOS, usar uma verifica√ß√£o mais robusta
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      
      if (isIOS) {
        // No iOS, verificar m√∫ltiplas formas
        const screenWidth = screen.width;
        const screenHeight = screen.height;
        const windowWidth = window.innerWidth;
        const windowHeight = window.innerHeight;
        
        // Verificar orienta√ß√£o do screen primeiro
        if (screen.orientation) {
          const isLandscapeByOrientation = screen.orientation.angle === 90 || screen.orientation.angle === -90;
          if (isLandscapeByOrientation) return true;
        }
        
        // Verificar window.orientation
        if (window.orientation !== undefined) {
          const isLandscapeByWindow = Math.abs(window.orientation) === 90;
          if (isLandscapeByWindow) return true;
        }
        
        // Fallback: comparar dimens√µes da janela
        // No iOS, √†s vezes as dimens√µes demoram para atualizar
        const isLandscapeByDimensions = windowWidth > windowHeight;
        
        // Tamb√©m verificar se a largura da janela √© pr√≥xima da altura da tela
        // (indicando que est√° em landscape)
        const isLandscapeByScreenComparison = windowWidth >= (screenHeight * 0.9);
        
        return isLandscapeByDimensions || isLandscapeByScreenComparison;
      } else {
        // Para Android e outros
  // Alguns Android (ex.: Galaxy S8+) podem reportar orienta√ß√£o errada; use m√∫ltiplos checks
  const byScreenAPI = (screen.orientation && (screen.orientation.angle === 90 || screen.orientation.angle === -90));
  const byWindowAPI = (window.orientation !== undefined && (window.orientation === 90 || window.orientation === -90));
  const byDimensions = window.innerWidth > window.innerHeight; // mais confi√°vel na pr√°tica
  return byScreenAPI || byWindowAPI || byDimensions;
      }
    }

    // Fun√ß√£o para mostrar aviso de orienta√ß√£o
    function showOrientationWarning() {
      // Criar overlay de aviso
      const warningOverlay = document.createElement('div');
      warningOverlay.id = 'orientation-warning';
      warningOverlay.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.95);
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 20000;
        font-size: 18px;
        text-align: center;
        padding: 20px;
        box-sizing: border-box;
      `;
      
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      
      warningOverlay.innerHTML = `
        <div style="background: #ff4444; padding: 20px; border-radius: 15px; margin-bottom: 30px;">
          üì± ‚ö†Ô∏è VIRE O CELULAR ‚ö†Ô∏è üì±
        </div>
        <div style="font-size: 24px; margin-bottom: 20px;">
          üîÑ Gire seu celular para o lado (landscape)
        </div>
        <div style="font-size: 16px; opacity: 0.8; line-height: 1.4;">
          O preview s√≥ funciona com o celular deitado<br>
          para melhor visualiza√ß√£o da claquete.<br>
          <strong>Depois clique para disparar!</strong>
        </div>
        ${isIOS ? `
          <div style="margin-top: 20px; font-size: 14px; opacity: 0.7; background: rgba(255,255,0,0.1); padding: 10px; border-radius: 8px;">
            üì± iPhone detectado: ap√≥s virar, aguarde alguns segundos<br>
            para a orienta√ß√£o se estabilizar completamente
          </div>
        ` : ''}
        <div style="margin-top: 30px; font-size: 14px; opacity: 0.6;">
          Esta mensagem desaparecer√° automaticamente<br>
          quando voc√™ virar o celular
        </div>
      `;
      
      document.body.appendChild(warningOverlay);
      
      let checkCount = 0;
      const maxChecks = isIOS ? 20 : 12; // Mais tentativas para iOS
      
      // Verificar orienta√ß√£o periodicamente
      const checkOrientation = () => {
        checkCount++;
        
        if (isMobileLandscape()) {
          document.body.removeChild(warningOverlay);
          // Aguardar mais tempo no iOS para estabiliza√ß√£o
          const delay = isIOS ? 800 : 500;
          setTimeout(() => {
            actuallyShowPreview();
          }, delay);
        } else if (checkCount < maxChecks) {
          // Intervalo menor no iOS para detectar mudan√ßa mais r√°pido
          const interval = isIOS ? 300 : 500;
          setTimeout(checkOrientation, interval);
        } else {
          // Se chegou ao limite de tentativas, permitir continuar mesmo assim
          // mas mostrar aviso
          const warning = document.createElement('div');
          warning.style.cssText = `
            position: fixed; bottom: 50px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 165, 0, 0.9); color: black; padding: 10px 20px;
            border-radius: 10px; font-size: 14px; z-index: 25000;
          `;
          warning.innerHTML = 'Continuando mesmo em portrait. Pode haver distor√ß√£o.';
          warningOverlay.appendChild(warning);
          
          setTimeout(() => {
            if (document.body.contains(warningOverlay)) {
              document.body.removeChild(warningOverlay);
            }
            actuallyShowPreview();
          }, 2000);
        }
      };
      
      // Come√ßar a verificar ap√≥s um breve delay
      setTimeout(checkOrientation, isIOS ? 600 : 400);
      
      // Adicionar listener para mudan√ßas de orienta√ß√£o no iOS
      if (isIOS) {
        const orientationHandler = () => {
          setTimeout(() => {
            if (isMobileLandscape() && document.body.contains(warningOverlay)) {
              document.body.removeChild(warningOverlay);
              actuallyShowPreview();
            }
          }, 500);
        };
        
        // M√∫ltiplos listeners para cobrir diferentes eventos no iOS
        window.addEventListener('orientationchange', orientationHandler);
        window.addEventListener('resize', orientationHandler);
        screen.orientation?.addEventListener('change', orientationHandler);
        
        // Cleanup listeners
        warningOverlay._cleanupListeners = () => {
          window.removeEventListener('orientationchange', orientationHandler);
          window.removeEventListener('resize', orientationHandler);
          screen.orientation?.removeEventListener('change', orientationHandler);
        };
      }
    }

    // Fun√ß√£o real para mostrar preview (depois da verifica√ß√£o de orienta√ß√£o)
    function actuallyShowPreview() {
      showNotification('Gerando preview...');
      
      // Esconder os controles temporariamente
      const controls = document.querySelector('.controls');
      controls.style.display = 'none';
      
      // Capturar apenas a claquete
      const claqueteElement = document.querySelector('.frame');
      
    // Capturar no tamanho natural do elemento (para o preview caber inteiro)
    html2canvas(claqueteElement, {
        backgroundColor: '#000000',
        scale: 2,
        useCORS: true,
        allowTaint: false,
        onclone: (clonedDoc) => {
          const clonedElement = clonedDoc.querySelector('.digital');
          if (clonedElement) {
            clonedElement.style.fontFamily = '"DS-Digi", monospace';
          }
          // Expandir a claquete ao m√°ximo horizontalmente durante a captura (sem margens)
          const clonedFrame = clonedDoc.querySelector('.frame');
          if (clonedFrame) {
            clonedFrame.style.width = '100vw';
            clonedFrame.style.margin = '0';
          }
        }
      }).then(canvas => {
        // Restaurar controles
        controls.style.display = 'flex';
        
        // Mostrar preview em tela cheia
        showPreviewFullscreen(canvas);
        
      }).catch(error => {
        controls.style.display = 'flex';
        console.error('Erro no preview:', error);
        showNotification('‚ùå Erro no preview');
      });
    }

    // Fun√ß√£o para mostrar preview em tela cheia (para c√¢mera) - COM VERIFICA√á√ÉO OBRIGAT√ìRIA DE LANDSCAPE
    function showPreview() {
      // Debug espec√≠fico para iPhone (pode ser removido depois)
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      if (isIOS) {
        console.log('iPhone detectado, verificando orienta√ß√£o...');
        console.log('screen.orientation:', screen.orientation);
        console.log('window.orientation:', window.orientation);
        console.log('window.innerWidth:', window.innerWidth);
        console.log('window.innerHeight:', window.innerHeight);
        console.log('screen.width:', screen.width);
        console.log('screen.height:', screen.height);
      }
      
      // VERIFICAR ORIENTA√á√ÉO OBRIGATORIAMENTE NO MOBILE
      if (!isMobileLandscape()) {
        showOrientationWarning();
        return;
      }
      
      // Se j√° est√° em landscape, mostrar preview diretamente
      actuallyShowPreview();
    }

    // Fun√ß√£o para mostrar preview em tela cheia (otimizado para c√¢mera)
    function showPreviewFullscreen(canvas) {
      // Criar elemento de preview
      const previewContainer = document.createElement('div');
      previewContainer.className = 'png-preview-fullscreen';
      
      // Criar imagem
      const img = document.createElement('img');
      img.src = canvas.toDataURL('image/png', 1.0);
      img.alt = 'Preview da Claquete';
      
      // Adicionar elementos
      previewContainer.appendChild(img);
      
      // Adicionar ao body
      document.body.appendChild(previewContainer);
      
      // Configura√ß√µes espec√≠ficas para mobile
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
      
      if (isMobile) {
        // Configurar viewport para tela cheia no mobile
        let viewport = document.querySelector('meta[name="viewport"]');
        const originalViewport = viewport ? viewport.getAttribute('content') : '';
        if (viewport) {
          viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
        }
        
        // Esconder interface do navegador
        document.documentElement.style.overflow = 'hidden';
        document.body.style.overflow = 'hidden';
        
        // Configura√ß√µes espec√≠ficas para iOS (Safari)
        if (isIOS) {
          // No iOS, usar abordagem diferente para "fullscreen"
          document.documentElement.style.height = '100vh';
          document.body.style.height = '100vh';
          
          // For√ßar height 100vh no preview container para iOS
          previewContainer.style.height = '100vh';
          previewContainer.style.width = '100vw';
          previewContainer.style.position = 'fixed';
          previewContainer.style.top = '0';
          previewContainer.style.left = '0';
          previewContainer.style.zIndex = '99999';
          
          // Ajustar para diferentes orienta√ß√µes no iOS
          const handleIOSOrientation = () => {
            const currentWidth = window.innerWidth;
            const currentHeight = window.innerHeight;
            
            // For√ßar recalculo das dimens√µes
            previewContainer.style.width = currentWidth + 'px';
            previewContainer.style.height = currentHeight + 'px';
            
            // Configurar a imagem para ocupar toda a tela mantendo aspect ratio
            img.style.width = currentWidth + 'px';
            img.style.height = currentHeight + 'px';
            img.style.objectFit = 'contain'; // manter claquete inteira
            img.style.objectPosition = 'center';
            img.style.padding = '0';
            img.style.margin = '0';
            
            // For√ßar reflow
            previewContainer.offsetHeight;
          };
          
          // Aplicar configura√ß√£o inicial
          setTimeout(handleIOSOrientation, 100);
          
          // Esconder barra de endere√ßos no Safari - m√∫ltiplas tentativas
          const hideIOSBars = () => {
            window.scrollTo(0, 1);
            setTimeout(() => window.scrollTo(0, 0), 100);
            setTimeout(() => {
              if (window.scrollY !== 0) {
                window.scrollTo(0, 0);
              }
            }, 200);
          };
          
          setTimeout(hideIOSBars, 100);
          setTimeout(hideIOSBars, 500);
          
          // Adicionar classe espec√≠fica para iOS
          previewContainer.classList.add('ios-fullscreen');
          
          // Listener para mudan√ßas de orienta√ß√£o no iOS
          const iosOrientationListener = () => {
            setTimeout(handleIOSOrientation, 300);
          };
          
          window.addEventListener('orientationchange', iosOrientationListener);
          window.addEventListener('resize', iosOrientationListener);
          
          // Cleanup para iOS
          previewContainer._iosCleanup = () => {
            window.removeEventListener('orientationchange', iosOrientationListener);
            window.removeEventListener('resize', iosOrientationListener);
            // Restaurar viewport
            if (viewport && originalViewport) {
              viewport.setAttribute('content', originalViewport);
            }
          };
          
        } else {
          // Android e outros: usar fullscreen nativo
          // Ajustar altura considerando safe areas no mobile
          previewContainer.style.height = '100vh';
          previewContainer.style.minHeight = '-webkit-fill-available';
        }
        
        // For√ßar scroll para esconder barra de endere√ßos (todos os mobiles)
        setTimeout(() => {
          window.scrollTo(0, 0);
          document.documentElement.scrollTop = 0;
          document.body.scrollTop = 0;
        }, 200);
        
        // Ajustar imagem para mobile
        if (!isIOS) { // iOS j√° foi configurado acima
          img.style.width = '100vw';
          img.style.height = '100vh';
          img.style.objectFit = 'contain'; // mostrar inteiro, sem cortes
          img.style.objectPosition = 'center';
          img.style.padding = '0';
          img.style.margin = '0';
        }
      }
      
      // Tentar fullscreen nativo APENAS para Android e desktop
      if (!isIOS) {
        const tryFullscreen = () => {
          if (previewContainer.requestFullscreen) {
            previewContainer.requestFullscreen().catch(() => {});
          } else if (previewContainer.webkitRequestFullscreen) {
            previewContainer.webkitRequestFullscreen().catch(() => {});
          } else if (previewContainer.mozRequestFullScreen) {
            previewContainer.mozRequestFullScreen().catch(() => {});
          }
        };
        
        // Delay para garantir que o elemento est√° no DOM
        setTimeout(tryFullscreen, 200);
      }
      
      // SISTEMA DE CLIQUE √öNICO COM FLASH E SOM DE CLAQUETE
      let hasTriggered = false; // Previne m√∫ltiplos cliques
      
      const triggerClapperEffect = (e) => {
        e.preventDefault();
        e.stopPropagation();
        
        console.log('triggerClapperEffect chamado!', hasTriggered); // Debug
        
        if (hasTriggered) return; // Evita m√∫ltiplos disparos
        hasTriggered = true;
        
        // Som de claquete simples usando data URL
        try {
          const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsFJHfH8N+QQAoUXrTp66hVFApGn+DyvmkcBDuB0fLNdSsF');
          audio.volume = 0.5;
          audio.play().catch(() => {}); // Ignora erro se n√£o conseguir tocar
        } catch (e) {
          console.log('Som n√£o dispon√≠vel');
        }
        
        // Criar flash branco ANDROID COMPAT√çVEL
        console.log('üî• Criando flash para Android...'); // Debug
        
        const flash = document.createElement('div');
        flash.id = 'android-flash-test';
        
        // M√∫ltiplas formas de aplicar estilos para Android
        flash.style.cssText = `
          position: fixed !important;
          top: 0 !important;
          left: 0 !important;
          width: 100vw !important;
          height: 100vh !important;
          background-color: white !important;
          z-index: 2147483647 !important;
          pointer-events: none !important;
          display: block !important;
          opacity: 1 !important;
        `;
        
        // Tamb√©m definir propriedades individualmente
        Object.assign(flash.style, {
          position: 'fixed',
          top: '0px',
          left: '0px',
          width: '100vw',
          height: '100vh',
          backgroundColor: '#FFFFFF',
          zIndex: '2147483647',
          pointerEvents: 'none',
          display: 'block',
          opacity: '1'
        });
        
        document.body.appendChild(flash);
        console.log('‚úÖ Flash Android criado:', flash, 'No DOM:', document.body.contains(flash));
        
        // For√ßar render
        flash.getBoundingClientRect();
        
        // Timeout mais longo para ser bem vis√≠vel no Android
        setTimeout(() => {
          console.log('üóëÔ∏è Removendo flash Android...');
          if (document.body.contains(flash)) {
            document.body.removeChild(flash);
          }
          // Fechar preview
          setTimeout(() => closePreviewFullscreen(), 200);
        }, 1000); // 1 segundo - bem vis√≠vel
        
        // Vibra√ß√£o no mobile se dispon√≠vel - mais forte
        if (navigator.vibrate) {
          navigator.vibrate([200, 50, 200]); // Vibra√ß√£o dupla mais longa
        }
        
        showNotification('üì∏ CLAC! Voltando √† edi√ß√£o...');
      };
      
      // Event listeners UNIVERSAIS para todos os dispositivos
      let touchStarted = false;
      let clickProcessed = false;
      
      // Detectar tipo de dispositivo
      const isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      const isTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      
      console.log('Dispositivo detectado:', { isMobileDevice, isTouch }); // Debug
      
      // Fun√ß√£o universal que funciona em todos os dispositivos
      const handleUniversalTrigger = (e, source) => {
        console.log('Evento disparado:', source, e.type); // Debug
        
        // Evitar processamento duplo
        if (clickProcessed) {
          console.log('Clique j√° processado, ignorando');
          return;
        }
        
        clickProcessed = true;
        triggerClapperEffect(e);
        
        // Reset ap√≥s um tempo
        setTimeout(() => {
          clickProcessed = false;
        }, 1000);
      };
      
      // M√öLTIPLOS EVENT LISTENERS para m√°xima compatibilidade
      
      // 1. Clique padr√£o (funciona na maioria dos dispositivos)
      previewContainer.addEventListener('click', (e) => {
        handleUniversalTrigger(e, 'click');
      });
      
      // 2. Touch events para dispositivos m√≥veis
      if (isTouch) {
        previewContainer.addEventListener('touchstart', (e) => {
          touchStarted = true;
          console.log('touchstart detectado');
        }, { passive: false });
        
        previewContainer.addEventListener('touchend', (e) => {
          if (touchStarted) {
            console.log('touchend detectado, disparando');
            handleUniversalTrigger(e, 'touchend');
          }
          touchStarted = false;
        }, { passive: false });
      }
      
      // 3. Pointer events (mais moderno, funciona em muitos dispositivos)
      if ('onpointerdown' in window) {
        previewContainer.addEventListener('pointerdown', (e) => {
          if (e.pointerType === 'touch') {
            console.log('pointerdown touch detectado');
            handleUniversalTrigger(e, 'pointerdown');
          }
        });
      }
      
      // 4. Mouse events como fallback
      previewContainer.addEventListener('mousedown', (e) => {
        // S√≥ no desktop ou se outros m√©todos falharam
        if (!isTouch || !isMobileDevice) {
          console.log('mousedown detectado');
          handleUniversalTrigger(e, 'mousedown');
        }
      });
      
      // 5. Tap event espec√≠fico para alguns dispositivos Android
      previewContainer.addEventListener('tap', (e) => {
        console.log('tap event detectado');
        handleUniversalTrigger(e, 'tap');
      });
      
      // Prevenir comportamentos padr√£o que podem interferir
      previewContainer.addEventListener('touchmove', (e) => {
        e.preventDefault();
      }, { passive: false });
      
      previewContainer.addEventListener('contextmenu', (e) => {
        e.preventDefault(); // Evita menu de contexto
      });
      
      // Tecla ESC para fechar
      const keyHandler = (e) => {
        if (e.key === 'Escape') {
          closePreviewFullscreen();
        }
      };
      
      document.addEventListener('keydown', keyHandler);
      previewContainer._keyHandler = keyHandler;
      
      showNotification('üé¨ Preview ativo! Clique para disparar a claquete');
    }

    // Fun√ß√£o para fechar preview
    function closePreviewFullscreen() {
      const preview = document.querySelector('.png-preview-fullscreen');
      const orientationWarning = document.getElementById('orientation-warning');
      
      // Fechar warning de orienta√ß√£o se estiver aberto
      if (orientationWarning) {
        // Limpar listeners do iOS se existirem
        if (orientationWarning._cleanupListeners) {
          orientationWarning._cleanupListeners();
        }
        if (document.body.contains(orientationWarning)) {
          document.body.removeChild(orientationWarning);
        }
      }
      
      if (preview) {
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        
        // Cleanup espec√≠fico para iOS
        if (isIOS && preview._iosCleanup) {
          preview._iosCleanup();
        }
        
        // Sair da tela cheia (apenas para n√£o-iOS)
        if (!isIOS) {
          if (document.exitFullscreen) {
            document.exitFullscreen().catch(() => {});
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen().catch(() => {});
          } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen().catch(() => {});
          }
        }
        
        // Restaurar configura√ß√µes do mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (isMobile) {
          // Restaurar viewport para configura√ß√£o padr√£o
          let viewport = document.querySelector('meta[name="viewport"]');
          if (viewport) {
            viewport.setAttribute('content', 'width=device-width, initial-scale=1');
          }
          
          // Restaurar overflow
          document.documentElement.style.overflow = '';
          document.body.style.overflow = '';
          
          // Restaura√ß√µes espec√≠ficas para iOS
          if (isIOS) {
            document.documentElement.style.height = '';
            document.body.style.height = '';
            
            // For√ßar scroll de volta ao topo
            setTimeout(() => {
              window.scrollTo(0, 0);
              document.documentElement.scrollTop = 0;
              document.body.scrollTop = 0;
            }, 100);
          }
        }
        
        // Remover event listener
        if (preview._keyHandler) {
          document.removeEventListener('keydown', preview._keyHandler);
        }
        
        // Remover elemento
        if (document.body.contains(preview)) {
          document.body.removeChild(preview);
        }
        
        showNotification('Preview fechado');
      }
    }

    // Teclas de atalho
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 's':
            e.preventDefault();
            saveData();
            break;
          case 'r':
            e.preventDefault();
            resetData();
            break;
          case 'e':
            e.preventDefault();
            exportImage();
            break;
          case 'Enter':
            if (document.activeElement === fields.take) {
              e.preventDefault();
              incrementTake();
            }
            break;
        }
      }
    });

    // Carregar dados salvos na inicializa√ß√£o
    window.addEventListener('load', function() {
      const saved = localStorage.getItem('claqueteData');
      if (saved) {
        const data = JSON.parse(saved);
        Object.keys(data).forEach(key => {
          if (fields[key] && data[key]) {
            fields[key].textContent = data[key];
          }
        });
      }
      
      // Iniciar atualiza√ß√£o autom√°tica da data/hora
      startDateTimeUpdater();
    });

    // Fun√ß√£o para atualizar data/hora automaticamente
    function startDateTimeUpdater() {
      function updateDateTime() {
        // S√≥ atualiza se o campo de data n√£o foi editado recentemente
        const now = new Date();
        const currentDateTime = getCurrentDate();
        
        // Verifica se o usu√°rio n√£o est√° editando o campo de data
        if (document.activeElement !== fields.date) {
          // Verifica se a data atual √© diferente da exibida
          const currentDisplayed = fields.date.textContent;
          const currentTime = currentDateTime.split(' ').slice(-1)[0]; // Pega s√≥ a hora
          const displayedTime = currentDisplayed.split(' ').slice(-1)[0]; // Pega s√≥ a hora exibida
          
          // Se a hora mudou, atualiza
          if (currentTime !== displayedTime) {
            fields.date.textContent = currentDateTime;
            autoSave();
          }
        }
      }
      
      // Atualiza a cada minuto (60000ms)
      setInterval(updateDateTime, 60000);
      
      // Primeira atualiza√ß√£o
      updateDateTime();
    }

    // Adicionar atalho de teclado (removido atalho de tela cheia)
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 's':
            e.preventDefault();
            saveData();
            break;
          case 'r':
            e.preventDefault();
            resetData();
            break;
          case 'e':
            e.preventDefault();
            exportImage();
            break;
          case 'p':
            e.preventDefault();
            showPreview();
            break;
        }
      }
    });
  </script>
</body>
</html>
