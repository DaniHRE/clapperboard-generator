<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Claquete Digital</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #000;
      --fg: #fff;
      --accent: #e11212;
      --border: #ffffff;
      --line: 2px;
      --maxw: 1280px;
      --gap: 0;
    }

    @font-face{
      font-family: "DS-Digi";
      src: url("./DS-DIGI.TTF") format("truetype");
      font-weight: 400 700;
      font-style: normal;
      font-display: swap;
    }

    *{ box-sizing: border-box; }
    html, body{ height: 100%; }
    body{
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: 'Montserrat', sans-serif;
      line-height: 1.25;
    }

    .frame{
      max-width: var(--maxw);
      margin: 24px auto;
      display: grid;
      gap: var(--gap);
    }

    .grid{
      display: grid;
      gap: var(--gap);
      grid-template-columns: repeat(12, 1fr);
    }

    .box{
      border: var(--line) solid var(--border);
      padding: clamp(12px, 1.5vw, 16px);
      min-height: 84px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .label{
      font-size: clamp(9px, 1vw, 11px);
      letter-spacing: .08em;
      text-transform: uppercase;
      opacity: 1;
      font-weight: bold;
      color: #ffffff;
      padding: 0 8px;
      margin-bottom: 2px;
    }
    .value{ margin-top: .1rem; font-weight: 700; font-size: clamp(15px, 1.8vw, 20px); padding: 0 12px; }
    .value-xl{ font-size: clamp(18px, 2.4vw, 24px); }
    .value-xxl{ font-size: clamp(36px, 5vw, 64px); }

    .digital{ font-family: "DS-Digi", monospace; color: var(--accent); letter-spacing: .04em; font-size: clamp(48px, 7vw, 90px) !important; }

    .top-left{ grid-column: 1 / span 6; }
    .top-right{ grid-column: 7 / span 6; padding: 0; display: flex; flex-direction: column; }

    .flexdata{
      display: flex;
      flex-direction: column;
      flex: 1;
      height: 100%;
    }
    .cell{
      flex: 1;
      border-top: var(--line) solid var(--border);
      padding: clamp(12px, 1.5vw, 16px);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .cell:first-child{ border-top: none; }

    /* Ajuste: FPS e Camera lado a lado na mesma linha */
    .row-split{
      display: grid;
      grid-template-columns: 1fr 1fr;
      flex: 1;
    }
    .row-split .cell{
      border-top: var(--line) solid var(--border);
      border-left: var(--line) solid var(--border);
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .row-split .cell:first-child{ border-left: none; }

    .center-banner{ grid-column: 1 / span 12; align-items: center; justify-content: center; text-align: center; padding: clamp(4px, 0.5vw, 8px); }

    .low-slate{ grid-column: 1 / span 3; }
    .low-roll{  grid-column: 4 / span 3; }
    .low-scene{ grid-column: 7 / span 3; }
    .low-take{  grid-column: 10 / span 3; }

    .notes{ grid-column: 1 / span 12; min-height: 96px; }

    @media (max-width: 760px){
      .top-left, .top-right, .center-banner, .low-slate, .low-roll, .low-scene, .low-take, .notes{
        grid-column: 1 / -1;
      }
      .value-xxl{ font-size: clamp(32px, 10vw, 56px); }
    }

    .stack > .pair + .pair{ margin-top: clamp(10px, 1.2vw, 14px); }

    /* Estilos para campos edit√°veis */
    [contenteditable="true"] {
      outline: none;
      cursor: text;
      transition: background-color 0.2s ease;
    }
    [contenteditable="true"]:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }
    [contenteditable="true"]:focus {
      background-color: rgba(255, 255, 255, 0.1);
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.2);
    }
    [contenteditable="true"]:empty:before {
      content: attr(data-placeholder);
      color: rgba(255, 255, 255, 0.5);
    }

    /* Controles */
    .controls {
      margin: 20px auto;
      text-align: center;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .btn {
      background: var(--bg);
      color: var(--fg);
      border: var(--line) solid var(--border);
      padding: 8px 16px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      transition: all 0.2s ease;
    }
    .btn:hover {
      background: var(--fg);
      color: var(--bg);
    }

    /* Modo Tela Cheia */
    .fullscreen-mode {
      position: fixed !important;
      top: 0;
      left: 0;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 9999;
      background: var(--bg);
      margin: 0 !important;
      max-width: none !important;
      padding: 0 !important;
    }

    .fullscreen-mode .grid {
      height: 100vh;
      width: 100vw;
      padding: clamp(4px, 1vw, 8px);
      box-sizing: border-box;
      margin: 0;
    }

    .fullscreen-mode .box {
      border-width: clamp(1px, 0.3vw, 2px);
      min-height: auto;
    }

    .fullscreen-mode .controls {
      position: fixed;
      top: 5px;
      right: 5px;
      background: rgba(0, 0, 0, 0.9);
      padding: 5px;
      border-radius: 6px;
      margin: 0;
      z-index: 10000;
      opacity: 0.2;
      transition: opacity 0.3s ease;
      transform: scale(0.7);
    }

    .fullscreen-mode .controls:hover,
    .fullscreen-mode .controls:active {
      opacity: 1;
      transform: scale(1);
    }

    .fullscreen-mode .controls .btn {
      padding: 4px 6px;
      font-size: 8px;
      margin: 1px;
      border-width: 1px;
    }

    .fullscreen-exit-btn {
      position: fixed !important;
      top: 10px;
      left: 10px;
      z-index: 10001;
      background: rgba(255, 0, 0, 0.9) !important;
      color: white !important;
      border: 1px solid white !important;
      padding: 8px 10px !important;
      font-size: 12px !important;
      border-radius: 6px;
      opacity: 0.6;
      transition: all 0.3s ease;
      transform: scale(0.8);
    }

    .fullscreen-exit-btn:hover,
    .fullscreen-exit-btn:active {
      opacity: 1;
      background: rgba(255, 0, 0, 1) !important;
      transform: scale(1);
    }

    /* Otimiza√ß√µes espec√≠ficas para mobile em tela cheia */
    @media (max-width: 768px) {
      .fullscreen-mode {
        /* Remover qualquer padding/margin */
        padding: 0 !important;
        margin: 0 !important;
      }
      
      .fullscreen-mode .grid {
        padding: 2px;
        gap: 0;
      }
      
      .fullscreen-mode .box {
        padding: clamp(4px, 1.5vw, 8px);
        border-width: 1px;
      }
      
      .fullscreen-mode .value-xxl {
        font-size: clamp(20px, 6vw, 40px) !important;
      }
      
      .fullscreen-mode .digital {
        font-size: clamp(28px, 8vw, 50px) !important;
        letter-spacing: 0.02em !important;
      }
      
      .fullscreen-mode .label {
        font-size: clamp(6px, 1.5vw, 9px);
        margin-bottom: 1px;
      }
      
      .fullscreen-mode .value {
        font-size: clamp(10px, 2.5vw, 14px);
        margin-top: 0.05rem;
      }
      
      .fullscreen-mode .value-xl {
        font-size: clamp(12px, 3vw, 18px);
      }

      /* Bot√£o de sa√≠da menor no mobile */
      .fullscreen-exit-btn {
        top: 5px;
        left: 5px;
        padding: 6px 8px !important;
        font-size: 10px !important;
        transform: scale(0.7);
      }
      
      .fullscreen-mode .controls {
        top: 3px;
        right: 3px;
        padding: 3px;
        transform: scale(0.6);
      }
      
      .fullscreen-mode .controls:hover,
      .fullscreen-mode .controls:active {
        transform: scale(0.8);
      }
    }

    /* Landscape espec√≠fico para celular */
    @media (max-width: 768px) and (orientation: landscape) {
      .fullscreen-mode .digital {
        font-size: clamp(32px, 10vw, 60px) !important;
      }
      
      .fullscreen-mode .value-xxl {
        font-size: clamp(24px, 7vw, 48px) !important;
      }
    }

    /* Portrait espec√≠fico para celular */
    @media (max-width: 768px) and (orientation: portrait) {
      .fullscreen-mode .grid {
        padding: 4px;
      }
      
      .fullscreen-mode .digital {
        font-size: clamp(24px, 6vw, 36px) !important;
      }
      
      .fullscreen-mode .value-xxl {
        font-size: clamp(18px, 5vw, 28px) !important;
      }
    }

    /* Ocultar scrollbars completamente */
    .fullscreen-mode::-webkit-scrollbar {
      display: none;
    }
    
    .fullscreen-mode {
      -ms-overflow-style: none;
      scrollbar-width: none;
      overflow: hidden;
    }

    /* Pr√©via PNG em Tela Cheia */
    .png-preview-fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: #000;
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      /* For√ßar ocupa√ß√£o total no mobile */
      min-height: -webkit-fill-available;
      min-height: 100vh;
      overflow: hidden;
    }

    .png-preview-fullscreen img {
      max-width: 100vw;
      max-height: 100vh;
      object-fit: contain;
      border: none;
      /* Garantir centraliza√ß√£o no mobile */
      display: block;
      margin: auto;
    }

    .png-preview-close {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255, 0, 0, 0.9);
      color: white;
      border: 2px solid white;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      z-index: 10001;
      font-weight: bold;
    }

    .png-preview-instructions {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 12px 20px;
      border-radius: 20px;
      font-size: 14px;
      text-align: center;
      z-index: 10001;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    @media (max-width: 768px) {
      .png-preview-instructions {
        bottom: 20px;
        font-size: 12px;
        padding: 8px 16px;
      }
    }

    /* Evitar zoom no mobile */
    .fullscreen-mode input,
    .fullscreen-mode [contenteditable] {
      font-size: 16px !important; /* Evita zoom autom√°tico no iOS */
    }
  </style>
</head>
<body>
  <main class="frame">
    <section class="grid">

      <div class="box top-left">
        <div class="stack">
          <div class="pair">
            <div class="label">Title</div>
            <div class="value value-xl" contenteditable="true" id="title">Metodologias √Ågeis</div>
          </div>
          <div class="pair">
            <div class="label">Dir</div>
            <div class="value value-xl" contenteditable="true" id="director">Lucas Caetano</div>
          </div>
          <div class="pair">
            <div class="label">DP</div>
            <div class="value value-xl" contenteditable="true" id="dp">Lucas Caetano</div>
          </div>
        </div>
      </div>

      <div class="box top-right">
        <div class="flexdata">
          <div class="cell">
            <div class="label">Date</div>
            <div class="value value-xl" contenteditable="true" id="date" style="font-size: 32px;">19 set 2025 - 14:30</div>
          </div>
          <div class="row-split">
            <div class="cell">
              <div class="label">FPS</div>
              <div class="value value-xl" contenteditable="true" id="fps" style="font-size: 45px;">30</div>
            </div>
            <div class="cell">
              <div class="label">Camera</div>
              <div class="value" contenteditable="true" id="camera" style="font-size: 53px;">&nbsp;</div>
            </div>
          </div>
        </div>
      </div>

      <div class="box center-banner">
        <div class="value-xxl digital" contenteditable="true" id="teaser">TEASER</div>
      </div>

      <div class="box low-slate">
        <div class="label">Slate</div>
        <div class="value value-xxl" contenteditable="true" id="slate">A1</div>
      </div>
      <div class="box low-roll">
        <div class="label">Roll</div>
        <div class="value value-xxl" contenteditable="true" id="roll">1</div>
      </div>
      <div class="box low-scene">
        <div class="label">Scene</div>
        <div class="value value-xxl" contenteditable="true" id="scene">1</div>
      </div>
      <div class="box low-take">
        <div class="label">Take</div>
        <div class="value value-xxl" contenteditable="true" id="take">1</div>
      </div>

      <div class="box notes">
        <div class="label">Notes</div>
        <div class="value" contenteditable="true" id="notes" style="min-height: 60px; margin-top: 8px;">&nbsp;</div>
      </div>

    </section>
    
    <div class="controls">
      <button class="btn" onclick="saveData()">Salvar</button>
      <button class="btn" onclick="loadData()">Carregar</button>
      <button class="btn" onclick="resetData()">Limpar</button>
      <button class="btn" onclick="incrementTake()">Next Take</button>
      <button class="btn" onclick="exportImage()">üíæ Exportar PNG</button>
      <button class="btn" onclick="showPreview()" id="preview-btn">üé¨ Preview</button>
    </div>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    // Campos edit√°veis
    const fields = {
      title: document.getElementById('title'),
      director: document.getElementById('director'),
      dp: document.getElementById('dp'),
      date: document.getElementById('date'),
      fps: document.getElementById('fps'),
      camera: document.getElementById('camera'),
      teaser: document.getElementById('teaser'),
      slate: document.getElementById('slate'),
      roll: document.getElementById('roll'),
      scene: document.getElementById('scene'),
      take: document.getElementById('take'),
      notes: document.getElementById('notes')
    };

    // Auto-save quando campos s√£o alterados
    Object.values(fields).forEach(field => {
      field.addEventListener('input', autoSave);
      field.addEventListener('blur', autoSave);
    });

    // S√≥ n√∫meros nos campos num√©ricos
    ['fps', 'roll', 'scene', 'take'].forEach(fieldName => {
      fields[fieldName].addEventListener('input', function(e) {
        this.textContent = this.textContent.replace(/[^0-9]/g, '');
      });
    });

    // Fun√ß√µes principais
    function saveData() {
      const data = {};
      Object.keys(fields).forEach(key => {
        data[key] = fields[key].textContent || fields[key].innerText;
      });
      localStorage.setItem('claqueteData', JSON.stringify(data));
      showNotification('Dados salvos!');
    }

    function loadData() {
      const saved = localStorage.getItem('claqueteData');
      if (saved) {
        const data = JSON.parse(saved);
        Object.keys(data).forEach(key => {
          if (fields[key]) {
            fields[key].textContent = data[key];
          }
        });
        showNotification('Dados carregados!');
      } else {
        showNotification('Nenhum dado salvo encontrado!');
      }
    }

    function resetData() {
      if (confirm('Limpar todos os campos?')) {
        fields.title.textContent = 'Metodologias √Ågeis';
        fields.director.textContent = 'Lucas Caetano';
        fields.dp.textContent = 'Lucas Caetano';
        fields.date.textContent = getCurrentDate();
        fields.fps.textContent = '30';
        fields.camera.textContent = '';
        fields.teaser.textContent = 'TEASER';
        fields.slate.textContent = 'A1';
        fields.roll.textContent = '1';
        fields.scene.textContent = '1';
        fields.take.textContent = '1';
        fields.notes.textContent = '';
        localStorage.removeItem('claqueteData');
        showNotification('Dados limpos!');
      }
    }

    function incrementTake() {
      const currentTake = parseInt(fields.take.textContent) || 0;
      fields.take.textContent = currentTake + 1;
      autoSave();
      showNotification(`Take: ${currentTake + 1}`);
    }

    function autoSave() {
      const data = {};
      Object.keys(fields).forEach(key => {
        data[key] = fields[key].textContent || fields[key].innerText;
      });
      localStorage.setItem('claqueteData', JSON.stringify(data));
    }

    function getCurrentDate() {
      const now = new Date();
      const months = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      return `${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()} - ${hours}:${minutes}`;
    }

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed; top: 20px; right: 20px; z-index: 1000;
        background: var(--bg); color: var(--fg); border: 2px solid var(--border);
        padding: 12px 16px; font-size: 12px; font-weight: 600;
        text-transform: uppercase; letter-spacing: 0.05em;
        opacity: 0; transform: translateX(100%); transition: all 0.3s ease;
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translateX(0)';
      }, 10);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => document.body.removeChild(notification), 300);
      }, 2500);
    }

    // Fun√ß√£o para exportar como imagem (s√≥ salva)
    function exportImage() {
      showNotification('Gerando e salvando imagem...');
      
      // Esconder os controles temporariamente
      const controls = document.querySelector('.controls');
      controls.style.display = 'none';
      
      // Capturar apenas a claquete
      const claqueteElement = document.querySelector('.frame');
      
      html2canvas(claqueteElement, {
        backgroundColor: '#000000',
        scale: 2, // Maior qualidade
        useCORS: true,
        allowTaint: false,
        width: claqueteElement.offsetWidth,
        height: claqueteElement.offsetHeight,
        onclone: (clonedDoc) => {
          // Garantir que a fonte seja carregada no clone
          const clonedElement = clonedDoc.querySelector('.digital');
          if (clonedElement) {
            clonedElement.style.fontFamily = '"DS-Digi", monospace';
          }
        }
      }).then(canvas => {
        // Restaurar controles
        controls.style.display = 'flex';
        
        // Criar nome do arquivo
        const slate = fields.slate.textContent || 'A1';
        const scene = fields.scene.textContent || '1';
        const take = fields.take.textContent || '1';
        const filename = `claquete_${slate}_${scene}_${take}.png`;
        
        // Download autom√°tico da imagem
        const link = document.createElement('a');
        link.download = filename;
        link.href = canvas.toDataURL('image/png', 1.0);
        link.click();
        
        showNotification(`‚úÖ Imagem salva: ${filename}`);
        
      }).catch(error => {
        // Restaurar controles em caso de erro
        controls.style.display = 'flex';
        console.error('Erro ao exportar:', error);
        showNotification('‚ùå Erro ao exportar imagem');
      });
    }

    // Fun√ß√£o para mostrar preview em tela cheia (para c√¢mera)
    function showPreview() {
      showNotification('Gerando preview...');
      
      // Esconder os controles temporariamente
      const controls = document.querySelector('.controls');
      controls.style.display = 'none';
      
      // Capturar apenas a claquete
      const claqueteElement = document.querySelector('.frame');
      
      html2canvas(claqueteElement, {
        backgroundColor: '#000000',
        scale: 2,
        useCORS: true,
        allowTaint: false,
        width: claqueteElement.offsetWidth,
        height: claqueteElement.offsetHeight,
        onclone: (clonedDoc) => {
          const clonedElement = clonedDoc.querySelector('.digital');
          if (clonedElement) {
            clonedElement.style.fontFamily = '"DS-Digi", monospace';
          }
        }
      }).then(canvas => {
        // Restaurar controles
        controls.style.display = 'flex';
        
        // Mostrar preview em tela cheia
        showPreviewFullscreen(canvas);
        
      }).catch(error => {
        controls.style.display = 'flex';
        console.error('Erro no preview:', error);
        showNotification('‚ùå Erro no preview');
      });
    }

    // Fun√ß√£o para mostrar preview em tela cheia (otimizado para c√¢mera)
    function showPreviewFullscreen(canvas) {
      // Criar elemento de preview
      const previewContainer = document.createElement('div');
      previewContainer.className = 'png-preview-fullscreen';
      
      // Criar imagem
      const img = document.createElement('img');
      img.src = canvas.toDataURL('image/png', 1.0);
      img.alt = 'Preview da Claquete';
      
      // Criar instru√ß√µes espec√≠ficas para c√¢mera (que vai desaparecer)
      const instructions = document.createElement('div');
      instructions.className = 'png-preview-instructions';
      instructions.innerHTML = 'Preview para c√¢mera ‚Ä¢ Toque para fechar';
      
      // Adicionar elementos
      previewContainer.appendChild(img);
      previewContainer.appendChild(instructions);
      
      // Adicionar ao body
      document.body.appendChild(previewContainer);
      
      // Configura√ß√µes espec√≠ficas para mobile
      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      
      if (isMobile) {
        // Configurar viewport para tela cheia no mobile
        let viewport = document.querySelector('meta[name="viewport"]');
        if (viewport) {
          viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
        }
        
        // Esconder interface do navegador
        document.documentElement.style.overflow = 'hidden';
        document.body.style.overflow = 'hidden';
        document.documentElement.style.height = '100vh';
        document.body.style.height = '100vh';
        
        // For√ßar scroll para esconder barra de endere√ßos
        setTimeout(() => {
          window.scrollTo(0, 0);
          document.documentElement.scrollTop = 0;
          document.body.scrollTop = 0;
        }, 100);
      }
      
      // Entrar em tela cheia nativa do navegador
      if (previewContainer.requestFullscreen) {
        previewContainer.requestFullscreen().catch(() => {});
      } else if (previewContainer.webkitRequestFullscreen) {
        previewContainer.webkitRequestFullscreen().catch(() => {});
      } else if (previewContainer.mozRequestFullScreen) {
        previewContainer.mozRequestFullScreen().catch(() => {});
      }
      
      // Fazer as instru√ß√µes desaparecerem ap√≥s 1 segundo
      setTimeout(() => {
        if (instructions && instructions.parentNode) {
          instructions.style.opacity = '0';
          setTimeout(() => {
            if (instructions.parentNode) {
              instructions.parentNode.removeChild(instructions);
            }
          }, 300); // Fade out suave
        }
      }, 1000);
      
      // Event listeners
      previewContainer.onclick = closePreviewFullscreen;
      
      // Tecla ESC para fechar
      const keyHandler = (e) => {
        if (e.key === 'Escape') {
          closePreviewFullscreen();
        }
      };
      
      document.addEventListener('keydown', keyHandler);
      previewContainer._keyHandler = keyHandler;
      
      showNotification('üé¨ Preview ativo! Posicione na c√¢mera');
    }

    // Fun√ß√£o para fechar preview
    function closePreviewFullscreen() {
      const preview = document.querySelector('.png-preview-fullscreen');
      if (preview) {
        // Sair da tela cheia
        if (document.exitFullscreen) {
          document.exitFullscreen().catch(() => {});
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen().catch(() => {});
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen().catch(() => {});
        }
        
        // Restaurar configura√ß√µes do mobile
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (isMobile) {
          // Restaurar viewport
          let viewport = document.querySelector('meta[name="viewport"]');
          if (viewport) {
            viewport.setAttribute('content', 'width=device-width, initial-scale=1');
          }
          
          // Restaurar overflow e height
          document.documentElement.style.overflow = '';
          document.body.style.overflow = '';
          document.documentElement.style.height = '';
          document.body.style.height = '';
        }
        
        // Remover event listener
        if (preview._keyHandler) {
          document.removeEventListener('keydown', preview._keyHandler);
        }
        
        // Remover elemento
        document.body.removeChild(preview);
        showNotification('Preview fechado');
      }
    }

    // Teclas de atalho
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 's':
            e.preventDefault();
            saveData();
            break;
          case 'r':
            e.preventDefault();
            resetData();
            break;
          case 'e':
            e.preventDefault();
            exportImage();
            break;
          case 'Enter':
            if (document.activeElement === fields.take) {
              e.preventDefault();
              incrementTake();
            }
            break;
        }
      }
    });

    // Carregar dados salvos na inicializa√ß√£o
    window.addEventListener('load', function() {
      const saved = localStorage.getItem('claqueteData');
      if (saved) {
        const data = JSON.parse(saved);
        Object.keys(data).forEach(key => {
          if (fields[key] && data[key]) {
            fields[key].textContent = data[key];
          }
        });
      }
      
      // Iniciar atualiza√ß√£o autom√°tica da data/hora
      startDateTimeUpdater();
    });

    // Fun√ß√£o para atualizar data/hora automaticamente
    function startDateTimeUpdater() {
      function updateDateTime() {
        // S√≥ atualiza se o campo de data n√£o foi editado recentemente
        const now = new Date();
        const currentDateTime = getCurrentDate();
        
        // Verifica se o usu√°rio n√£o est√° editando o campo de data
        if (document.activeElement !== fields.date) {
          // Verifica se a data atual √© diferente da exibida
          const currentDisplayed = fields.date.textContent;
          const currentTime = currentDateTime.split(' ').slice(-1)[0]; // Pega s√≥ a hora
          const displayedTime = currentDisplayed.split(' ').slice(-1)[0]; // Pega s√≥ a hora exibida
          
          // Se a hora mudou, atualiza
          if (currentTime !== displayedTime) {
            fields.date.textContent = currentDateTime;
            autoSave();
          }
        }
      }
      
      // Atualiza a cada minuto (60000ms)
      setInterval(updateDateTime, 60000);
      
      // Primeira atualiza√ß√£o
      updateDateTime();
    }

    // Adicionar atalho de teclado (removido atalho de tela cheia)
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 's':
            e.preventDefault();
            saveData();
            break;
          case 'r':
            e.preventDefault();
            resetData();
            break;
          case 'e':
            e.preventDefault();
            exportImage();
            break;
          case 'p':
            e.preventDefault();
            showPreview();
            break;
        }
      }
    });
  </script>
</body>
</html>
